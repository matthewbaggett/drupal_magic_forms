<?php

require_once("lib/magic_form.inc");
require_once("lib/magic_form_item.inc");
require_once("lib/magic_form_field.inc");
require_once("lib/magic_form_field_button.inc");
require_once("lib/magic_form_field_datatable.inc");
require_once("lib/magic_form_field_multi.inc");
require_once("lib/magic_form_field_radio.inc");
require_once("lib/magic_form_field_select.inc");
require_once("lib/magic_form_field_submit.inc");
require_once("lib/magic_form_field_text.inc");
require_once("lib/magic_form_field_textarea.inc");
require_once("lib/magic_form_group.inc");
require_once("lib/magic_serialisable_closure.inc");

function magic_forms_init()
{
    if (isset($_POST['magic_form_id'])) {
        magic_form::process($_POST['magic_form_id']);
    }

    magic_form::cleanup_expired_forms();
}

/**
 * Crunch through a view
 *
 * @param string $file File of the template to call.
 * @param array|object $view Optional view array.
 *
 * @return string
 */
function magic_forms_template_view($file, $view = null)
{
    $file = DRUPAL_ROOT . "/" . drupal_get_path('module', 'magic_forms') . '/templates/' . $file;
    if (!file_exists($file)) {
        return "Cannot find {$file}";
    }
    extract((array)$view);
    ob_start();
    require($file);
    $markup = ob_get_contents();
    ob_end_clean();
    return $markup;
}

/**
 * CSS class mangler
 * Mangle a string like "Layout Magic Doodah" to "layout-magic-doodah" for use as a CSS class
 *
 * @param string $text text string to mangle
 *
 * @return string css class
 */
function magic_forms_mangle_to_css_class($text)
{
    $text = str_replace(" ", "-", $text);
    $text = preg_replace("/[^a-zA-Z0-9-]+/", "", $text);
    $text = strtolower($text);
    return $text;
}